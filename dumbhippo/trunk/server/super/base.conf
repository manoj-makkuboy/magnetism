<?xml version="1.0" encoding="UTF-8"?>
<superconf>
    <parameter name="basedir">$home/dhdeploy</parameter>
    <parameter name="baseport">21000</parameter>
    <parameter name="svndir">$superdir/../..</parameter>

    <parameter name="mysqlPort">$((baseport+0))</parameter>
    <parameter name="mysqlPassword">MangoChutney</parameter>
    <parameter name="mysqlTargetdir">$basedir/mysql</parameter>
    <parameter name="mysqlOptions">--defaults-file=$mysqlTargetdir/conf/my.cnf</parameter>

    <service name="mysql">
	<parameter name="targetdir">$mysqlTargetdir</parameter>
        <merge src="$superdir/mysql/files"
               expand="yes"/>
	
       <parameter name="startCommand">$superdir/mysql/mysql-start.sh $targetdir</parameter>
       <parameter name="stopCommand">$superdir/mysql/mysql-stop.sh $targetdir</parameter>
    </service>

    <service name="jboss">
	<requiredService service="mysql"/>

       <parameter name="jbossdir">/opt/jboss</parameter>
       <parameter name="targetdir">$basedir/jboss</parameter>

       <parameter name="jnpPort">$((baseport+10))</parameter>
       <parameter name="jrmpRmiPort">$((baseport+11))</parameter>
 
       <merge src="$jbossdir/server/all"
              exclude="$superdir/jboss/jboss.exclude"
              symlink="yes"/>
       <!-- The 'all' config is clustered, we need a non-clustered configiration for TomCat -->
       <merge src="$jbossdir/server/default/deploy/jbossweb-tomcat55.sar/META-INF/jboss-service.xml"
              dest="deploy/jbossweb-tomcat55.sar/META-INF/jboss-service.xml"
              symlink="yes"/>
       <merge src="$superdir/jboss/files"
              expand="yes"/>
       <merge src="$svndir/server/lib/mysql-connector-java-3.1.10-bin.jar"
              dest="lib/mysql-connector-java.jar"/>
       <merge src="$svndir/server/target/classes/dumbhippo.ear"
              dest="deploy/dumbhippo.ear"
              hot="yes"/>
  
       <parameter name="startCommand">$targetdir/scripts/jboss-start.sh</parameter>
       <parameter name="stopCommand">$jbossdir/bin/shutdown.sh -s jnp://localhost:$jnpPort</parameter>
    </service>

    <service name="jive">
	<requiredService service="mysql"/>
	<requiredService service="jboss"/>

	<parameter name="targetdir">$basedir/jive</parameter>
	<parameter name="jivedir">$svndir/jive_messenger/target</parameter>

	<parameter name="jivePlainPort">$((baseport+20))</parameter>
	<parameter name="jiveSecurePort">$((baseport+21))</parameter>
	<parameter name="jiveServerPort">$((baseport+22))</parameter>
	<parameter name="jiveComponentPort">$((baseport+23))</parameter>
	<parameter name="jiveAdminPort">$((baseport+24))</parameter>
	<parameter name="jiveAdminSecurePort">$((baseport+25))</parameter>
	
	<merge src="$jivedir"
	       exclude="$superdir/jive/jive.exclude"/>
        <merge src="$superdir/jive/files"
               expand="yes"/>

       <parameter name="startCommand">$targetdir/scripts/jive-start.sh</parameter>
       <parameter name="stopCommand">$targetdir/scripts/jive-stop.sh</parameter>
    </service>
</superconf>
